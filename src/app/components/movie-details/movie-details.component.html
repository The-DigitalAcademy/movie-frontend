<div *ngIf="movie" class="movie-details-container">

  <!-- ====== MOVIE HEADER ====== -->
  <div class="movie-header">
    <img
      [src]="movie?.primaryImage || 'assets/images/placeholder.jpg'"
      alt="{{ movie?.primaryTitle || 'Movie poster' }}"
      class="movie-poster"
    />

    <div class="movie-info">
      <h1>{{ movie?.primaryTitle || 'Untitled Movie' }}</h1>

      <div class="movie-meta">
        <span *ngIf="movie?.averageRating">{{ movie.averageRating }}/10</span>
        <span *ngIf="movie?.startYear">{{ movie.startYear }}</span>
        <span *ngIf="movie?.type">{{ movie.type }}</span>
      </div>

      <p>{{ movie?.description || 'No synopsis available.' }}</p>

      <div class="action-buttons">
        <button class="watch-btn" (click)="watchNow()">Watch Now</button>
        <button class="favorite-btn" (click)="toggleFavorite()">
          
          <span *ngIf="!isFavorite">Add to Favorites</span>
          <span *ngIf="isFavorite">Favorited</span>
        </button>

        <button (click)="addToWatchlist()">Add to Watchlist</button>
      </div>
    </div>
  </div>

  <!-- ====== CAST SECTION ====== -->
  <div class="cast-section" *ngIf="movieDetails.length > 0">
    <h2>Starring</h2>
    <div class="cast-grid">
      <div class="cast-member" *ngFor="let actor of movieDetails">
        <img [src]="actor?.primaryImage || 'assets/images/placeholder.jpg'" [alt]="actor?.fullName || 'Actor'" />
        <p>{{ actor?.fullName || 'Unknown Actor' }}</p>
      </div>
    </div>
  </div>

  <!-- ====== REVIEWS SECTION ====== -->
  <div class="reviews-section">
    <h2>Reviews</h2>
    <button (click)="toggleReviews()">
      {{ showReviews ? 'Hide Reviews' : 'Show Reviews' }}
    </button>


    <button class="add-review-btn" (click)="openReviewForm()">Write a Review</button>

    <!-- 
    <div class="review-form" *ngIf="showReviewForm">
      <label>Rating (1â€“10)</label>
      <input type="number" [(ngModel)]="newReview.rating" min="1" max="10" />

      <label>Review</label>
      <textarea rows="4" [(ngModel)]="newReview.text"></textarea>

      <button (click)="submitReview()">Submit Review</button>
    </div>
    -->
  </div>

  <!-- ====== RECOMMENDATIONS SECTION ====== -->
  <!-- 
  <div class="recommendations-section" *ngIf="movieDetails.recommendations?.length">
    <h2>You Might Also Like</h2>
    <div class="recommendations-grid">
      <div class="recommendation-card" *ngFor="let rec of movieDetails.recommendations">
        <img [src]="rec.imageUrl" [alt]="rec.title" />
        <p>{{ rec.title }}</p>
      </div>
    </div>
  </div>
  -->

  <!-- ====== LOGIN MODAL ====== -->
  <div class="login-modal" *ngIf="showLoginModal">
    <div class="login-modal-content">
      <h2>Please Log In</h2>
      <p>You must be logged in to add a review.</p>
      <button (click)="closeLoginModal()">Close</button>
      <button routerLink="/login">Go to Login</button>
    </div>
  </div>
</div>

<!-- Fallback for missing movie -->
<!-- <div *ngIf="!movie" class="movie-details-container">
  <h2>Movie not found</h2>
  <p>The movie you're looking for could not be found.</p>
  <button routerLink="/movies">Back to Movies</button>
</div> -->